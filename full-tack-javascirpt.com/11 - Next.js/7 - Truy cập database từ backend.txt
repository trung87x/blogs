ğŸ§  Model 7: Truy cáº­p database tá»« backend trong Next.js
--------------------------------------------------------
â€¢ Vai trÃ²: Gá»i CSDL tá»« cÃ¡c API route cá»§a Next.js.
â€¢ Controller:
  - Káº¿t ná»‘i Prisma/MongoDB/PostgreSQL trong `lib/db.ts`.
  - Thá»±c thi cÃ¡c truy váº¥n trong `app/api/.../route.ts`.

ğŸŒ Ngá»¯ cáº£nh #7: Táº¡o API `/api/products` láº¥y dá»¯ liá»‡u tháº­t tá»« Prisma
--------------------------------------------------------------------
â€¢ Má»¥c tiÃªu: Tráº£ vá» danh sÃ¡ch sáº£n pháº©m tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u thay vÃ¬ mock data.
â€¢ YÃªu cáº§u: CÃ i Prisma, cáº¥u hÃ¬nh schema, migrate DB.

ğŸ“¦ 1. CÃ i Ä‘áº·t Prisma (náº¿u chÆ°a cÃ³):

```bash
npm install prisma --save-dev
npx prisma init
```

ğŸ§© 2. Cáº¥u hÃ¬nh schema Prisma (`prisma/schema.prisma`):

```prisma
model Product {
  id    Int    @id @default(autoincrement())
  name  String
  price Int
}
```

ğŸ’¾ 3. Migrate vÃ  seed dá»¯ liá»‡u:

```bash
npx prisma migrate dev --name init
npx prisma studio   # Ä‘á»ƒ thÃªm sáº£n pháº©m báº±ng giao diá»‡n
```

ğŸ”Œ 4. Káº¿t ná»‘i CSDL (`lib/prisma.ts`):

```ts
import { PrismaClient } from '@prisma/client'
const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined
}

export const prisma =
  globalForPrisma.prisma ??
  new PrismaClient({ log: ['query'] })

if (process.env.NODE_ENV !== 'production')
  globalForPrisma.prisma = prisma
```

ğŸ“ 5. API route: `app/api/products/route.ts`

```ts
import { prisma } from '@/lib/prisma'
import { NextResponse } from 'next/server'

export async function GET() {
  const products = await prisma.product.findMany()
  return NextResponse.json(products)
}
```

ğŸ¯ Sá»­ dá»¥ng:

- CSR: `fetch('/api/products')`
- SSR/SSG: `fetch('http://localhost:3000/api/products')`

âœ… Káº¿t quáº£:
- API `/api/products` tráº£ danh sÃ¡ch tá»« database tháº­t.
- CÃ³ thá»ƒ má»Ÿ rá»™ng Ä‘á»ƒ thÃªm, xÃ³a, sá»­a sáº£n pháº©m vá»›i `POST`, `PUT`, `DELETE`.

ğŸ§  Ghi nhá»›:
- Prisma giÃºp truy cáº­p DB dá»… dÃ ng, type-safe trong Next.js.
- TÃ¡ch káº¿t ná»‘i Prisma vÃ o `lib/` Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng trong nhiá»u route.
- API trong Next.js cÃ³ thá»ƒ coi lÃ  má»™t Express thu nhá».

ğŸ“š Gá»£i Ã½ má»Ÿ rá»™ng:
- `POST`: táº¡o sáº£n pháº©m má»›i â†’ dÃ¹ng `request.json()`
- `DELETE`: xÃ³a sáº£n pháº©m theo `id`
- `GET`: láº¥y chi tiáº¿t sáº£n pháº©m `/api/products/[id]`
