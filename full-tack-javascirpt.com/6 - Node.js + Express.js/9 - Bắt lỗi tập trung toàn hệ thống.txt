[Ngá»¯ cáº£nh #9] Báº¯t lá»—i táº­p trung toÃ n há»‡ thá»‘ng (MVC)

ğŸ¯ Má»¥c tiÃªu:
- Gom toÃ n bá»™ lá»—i (logic, truy váº¥n DB, khÃ´ng tÃ¬m tháº¥y route...) vá» 1 nÆ¡i
- TrÃ¡nh trÃ¹ng láº·p `try/catch` kháº¯p nÆ¡i
- TÄƒng kháº£ nÄƒng debug, log lá»—i

ğŸ“ Cáº¥u trÃºc:
backend-mvc/
â”œâ”€â”€ server.js
â”œâ”€â”€ middlewares/
â”‚   â””â”€â”€ error.middleware.js
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ user.route.js
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ user.controller.js

---------------------
ğŸ“„ middlewares/error.middleware.js
---------------------
const errorHandler = (err, req, res, next) => {
  console.error('ğŸ”¥ Lá»—i:', err.stack);
  res.status(err.status || 500).json({
    error: err.message || 'CÃ³ lá»—i xáº£y ra tá»« server!'
  });
};

module.exports = errorHandler;

---------------------
ğŸ“„ controllers/user.controller.js
---------------------
exports.getUser = (req, res, next) => {
  try {
    // VÃ­ dá»¥ lá»—i giáº£ láº­p
    throw new Error('KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng!');
  } catch (err) {
    next(err); // Ä‘áº©y lá»—i xuá»‘ng middleware lá»—i
  }
};

---------------------
ğŸ“„ routes/user.route.js
---------------------
const express = require('express');
const router = express.Router();
const userController = require('../controllers/user.controller');

router.get('/user', userController.getUser);

module.exports = router;

---------------------
ğŸ“„ server.js
---------------------
const express = require('express');
const app = express();
const userRoutes = require('./routes/user.route');
const errorHandler = require('./middlewares/error.middleware');

app.use(express.json());
app.use('/', userRoutes);

// Middleware xá»­ lÃ½ lá»—i Ä‘áº·t sau táº¥t cáº£ routes
app.use(errorHandler);

// Khá»Ÿi Ä‘á»™ng
app.listen(3000, () => {
  console.log('ğŸš€ Server cháº¡y táº¡i http://localhost:3000');
});

---------------------
ğŸ“Œ Ghi chÃº:
---------------------
- `next(err)` giÃºp Express chuyá»ƒn lá»—i xuá»‘ng middleware cuá»‘i
- CÃ³ thá»ƒ gáº¯n thÃªm `err.status = 404` trÆ°á»›c khi `next(err)`
- DÃ¹ng `errorHandler` Ä‘á»ƒ log ra file / gá»­i vá» monitoring service náº¿u cáº§n
