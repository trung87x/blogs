# Tá»•ng há»£p 10 NGá»® Cáº¢NH CÆ  Báº¢N Vá»šI POSTGRESQL

--------------------------------------------------
# Ngá»¯ cáº£nh 1: Táº¡o báº£ng ngÆ°á»i dÃ¹ng vÃ  lÆ°u thÃ´ng tin cÆ¡ báº£n

ðŸ§  Model:
- Táº¡o báº£ng `users` vá»›i cÃ¡c cá»™t: id, name, age, email, is_active, created_at.

ðŸ› ï¸ SQL:
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  age INTEGER CHECK (age >= 0),
  email VARCHAR(100) UNIQUE NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO users (name, age, email)
VALUES ('Trung Äinh', 28, 'trung@example.com');

SELECT * FROM users;

--------------------------------------------------
# Ngá»¯ cáº£nh 2: Má»™t bÃ i viáº¿t thuá»™c vá» má»™t ngÆ°á»i dÃ¹ng (user-post)

ðŸ§  Model:
- Quan há»‡ 1-nhiá»u: 1 user â†’ nhiá»u posts. Báº£ng posts cÃ³ user_id lÃ m khÃ³a ngoáº¡i.

ðŸ› ï¸ SQL:
CREATE TABLE posts (
  id SERIAL PRIMARY KEY,
  title TEXT NOT NULL,
  content TEXT,
  user_id INTEGER NOT NULL REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO posts (title, content, user_id)
VALUES ('Giá»›i thiá»‡u PostgreSQL', 'BÃ i viáº¿t nÃ y nÃ³i vá» PostgreSQL...', 1);

SELECT posts.id, posts.title, users.name AS author
FROM posts
JOIN users ON posts.user_id = users.id;

--------------------------------------------------
# Ngá»¯ cáº£nh 3: ThÃªm má»›i ngÆ°á»i dÃ¹ng, sá»­a thÃ´ng tin, xoÃ¡ khá»i há»‡ thá»‘ng

ðŸ§  Model:
- CRUD ngÆ°á»i dÃ¹ng: INSERT, SELECT, UPDATE, DELETE.

ðŸ› ï¸ SQL:
INSERT INTO users (name, email)
VALUES ('Nguyá»…n VÄƒn A', 'a@example.com');

UPDATE users
SET name = 'Nguyá»…n VÄƒn B', is_active = false
WHERE id = 1;

DELETE FROM users WHERE id = 1;

--------------------------------------------------
# Ngá»¯ cáº£nh 4: TÃ¬m ngÆ°á»i dÃ¹ng theo tÃªn, sáº¯p xáº¿p theo ngÃ y táº¡o, phÃ¢n trang danh sÃ¡ch

ðŸ§  Model:
- Truy váº¥n cÃ³ Ä‘iá»u kiá»‡n, sáº¯p xáº¿p, phÃ¢n trang (ILIKE, ORDER BY, LIMIT, OFFSET).

ðŸ› ï¸ SQL:
SELECT * FROM users WHERE name ILIKE '%trung%';

SELECT * FROM users ORDER BY created_at DESC LIMIT 10 OFFSET 0;

--------------------------------------------------
# Ngá»¯ cáº£nh 5: Hiá»ƒn thá»‹ danh sÃ¡ch bÃ i viáº¿t kÃ¨m tÃªn tÃ¡c giáº£

ðŸ§  Model:
- JOIN báº£ng posts vá»›i users Ä‘á»ƒ láº¥y tÃªn tÃ¡c giáº£.

ðŸ› ï¸ SQL:
SELECT posts.id, posts.title, users.name AS author, posts.created_at
FROM posts
JOIN users ON posts.user_id = users.id;

--------------------------------------------------
# Ngá»¯ cáº£nh 6: Thá»‘ng kÃª sá»‘ bÃ i viáº¿t má»—i ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng

ðŸ§  Model:
- DÃ¹ng GROUP BY vÃ  COUNT Ä‘á»ƒ thá»‘ng kÃª bÃ i viáº¿t theo user.

ðŸ› ï¸ SQL:
SELECT users.name, COUNT(posts.id) AS total_posts
FROM users
LEFT JOIN posts ON users.id = posts.user_id
GROUP BY users.id, users.name
ORDER BY total_posts DESC;

--------------------------------------------------
# Ngá»¯ cáº£nh 7: TÄƒng tá»‘c truy váº¥n khi dá»¯ liá»‡u lá»›n (email, username)

ðŸ§  Model:
- Táº¡o chá»‰ má»¥c (INDEX) cho cÃ¡c cá»™t thÆ°á»ng truy váº¥n.

ðŸ› ï¸ SQL:
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_name ON users(name);

EXPLAIN ANALYZE SELECT * FROM users WHERE email = 'trung@example.com';

--------------------------------------------------
# Ngá»¯ cáº£nh 8: Äáº£m báº£o email lÃ  duy nháº¥t, tuá»•i > 0, tÃªn khÃ´ng Ä‘á»ƒ trá»‘ng

ðŸ§  Model:
- DÃ¹ng rÃ ng buá»™c NOT NULL, UNIQUE, CHECK Ä‘á»ƒ báº£o vá»‡ dá»¯ liá»‡u.

ðŸ› ï¸ SQL:
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  age INTEGER CHECK (age > 0),
  email VARCHAR(100) UNIQUE NOT NULL
);

-- Lá»—i náº¿u vi pháº¡m:
-- name = NULL, age <= 0, email trÃ¹ng

--------------------------------------------------
# Ngá»¯ cáº£nh 9: Xá»­ lÃ½ nhiá»u thao tÃ¡c trong má»™t giao dá»‹ch (táº¡o user + log + gá»­i mail)

ðŸ§  Model:
- DÃ¹ng transaction Ä‘á»ƒ Ä‘áº£m báº£o táº¥t cáº£ thao tÃ¡c cÃ¹ng thÃ nh cÃ´ng hoáº·c cÃ¹ng rollback.

ðŸ› ï¸ SQL:
BEGIN;

INSERT INTO users (name, email) VALUES ('Trung Äinh', 'trung@example.com');
INSERT INTO logs (action) VALUES ('Táº¡o ngÆ°á»i dÃ¹ng: Trung Äinh');

COMMIT;
-- Náº¿u lá»—i:
-- ROLLBACK;

--------------------------------------------------
# Ngá»¯ cáº£nh 10: DÃ¹ng Prisma/Sequelize Ä‘á»ƒ quáº£n lÃ½ schema vÃ  migrations

ðŸ§  Model:
- ORM giÃºp quáº£n lÃ½ cáº¥u trÃºc DB báº±ng code, dá»… migrate/rollback.

ðŸ› ï¸ Prisma:
npx prisma init
# schema.prisma
model User {
  id    Int    @id @default(autoincrement())
  name  String
  email String @unique
}
npx prisma migrate dev --name init

ðŸ› ï¸ Sequelize:
npx sequelize init
npx sequelize model:generate --name User --attributes name:string,email:string
npx sequelize db:migrate

