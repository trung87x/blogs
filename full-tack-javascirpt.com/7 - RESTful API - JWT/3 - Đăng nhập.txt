===========================================
ğŸ§© Ngá»¯ cáº£nh #3: ÄÄƒng nháº­p ngÆ°á»i dÃ¹ng
===========================================

ğŸ§  MÃ´ hÃ¬nh (Model) â€“ Ã nghÄ©a:
ÄÄƒng nháº­p lÃ  quÃ¡ trÃ¬nh xÃ¡c thá»±c ngÆ°á»i dÃ¹ng dá»±a trÃªn email vÃ  password.

Náº¿u Ä‘Ãºng â†’ táº¡o JWT token Ä‘á»ƒ ghi nháº­n user Ä‘Äƒng nháº­p.  
Náº¿u sai â†’ tráº£ lá»—i, khÃ´ng cáº¥p quyá»n truy cáº­p.

---

ğŸ› ï¸ Controller â€“ CÃ¡c bÆ°á»›c xá»­ lÃ½:
1. Nháº­n POST request vá»›i email & password
2. TÃ¬m user theo email trong MongoDB
3. So sÃ¡nh password ngÆ°á»i dÃ¹ng nháº­p vá»›i password Ä‘Ã£ hash trong DB
4. Náº¿u Ä‘Ãºng â†’ táº¡o JWT Token
5. Gá»­i pháº£n há»“i thÃ nh cÃ´ng (gá»“m token)
6. Náº¿u sai â†’ tráº£ lá»—i 401

---

ğŸ“¦ CÃ i Ä‘áº·t thÆ° viá»‡n:
npm install bcrypt jsonwebtoken

---

ğŸ“„ File: routes/auth.js (ná»‘i tiáº¿p pháº§n Ä‘Äƒng kÃ½)
-------------------------------------------------
const jwt = require('jsonwebtoken');

router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    // 1. Kiá»ƒm tra email cÃ³ tá»“n táº¡i
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(401).json({ message: 'Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng' });
    }

    // 2. So sÃ¡nh máº­t kháº©u
    const isMatch = await bcrypt.compare(password, user.password);
    if (!isMatch) {
      return res.status(401).json({ message: 'Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng' });
    }

    // 3. Táº¡o JWT Token
    const token = jwt.sign(
      { userId: user._id, email: user.email },
      'SECRET_KEY', // nÃªn dÃ¹ng biáº¿n mÃ´i trÆ°á»ng
      { expiresIn: '1h' }
    );

    // 4. Tráº£ pháº£n há»“i
    res.json({
      message: 'ÄÄƒng nháº­p thÃ nh cÃ´ng',
      token
    });

  } catch (err) {
    res.status(500).json({ message: 'Lá»—i server', error: err.message });
  }
});

---

ğŸ§ª Test API:
- URL: POST http://localhost:3000/api/auth/login
- Body JSON:
{
  "email": "trung@example.com",
  "password": "123456"
}

- Káº¿t quáº£ thÃ nh cÃ´ng:
{
  "message": "ÄÄƒng nháº­p thÃ nh cÃ´ng",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6..."
}

---

ğŸ“Œ GHI CHÃš QUAN TRá»ŒNG:

âœ… KhÃ´ng so sÃ¡nh máº­t kháº©u báº±ng toÃ¡n tá»­ `==`  
â†’ LuÃ´n dÃ¹ng `bcrypt.compare(plain, hashed)`

âœ… KhÃ´ng tráº£ lá»—i rÃµ rÃ ng nhÆ° â€œemail saiâ€ hay â€œmáº­t kháº©u saiâ€ riÃªng biá»‡t  
â†’ Gá»™p láº¡i chung: "Email hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng"  
â†’ GiÃºp trÃ¡nh dÃ² email há»£p lá»‡

âœ… Token nÃªn lÆ°u á»Ÿ:
- `localStorage`: dá»… thao tÃ¡c, nhÆ°ng dá»… bá»‹ XSS
- `HTTP-only cookie`: an toÃ n hÆ¡n, trÃ¡nh XSS

âœ… KhÃ´ng ghi 'SECRET_KEY' trá»±c tiáº¿p trong mÃ£ nguá»“n  
â†’ Sá»­ dá»¥ng `.env` + `dotenv`

---

âœ… Báº¡n Ä‘Ã£ sáºµn sÃ ng Ä‘á»ƒ tiáº¿p tá»¥c:
ğŸ‘‰ Ngá»¯ cáº£nh #4: Middleware xÃ¡c thá»±c JWT token?
